# IMPORTANT: Run docker compose from THIS directory (git-cms/)
# The build context is set to parent (..) so Docker can access both
# git-cms/ and git-stunts/ directories for the build.
#
# Expected structure:
#   ~/git/
#     git-cms/       ← Run docker compose here
#     git-stunts/    ← Lego blocks (required)

services:
  app:
    build:
      context: ..  # Parent dir so we can access both git-cms and git-stunts
      dockerfile: git-cms/Dockerfile
      target: dev
    volumes:
      - .:/app
      - /app/node_modules
    ports:
      - "4638:4638"
    environment:
      - PORT=4638
      - GIT_CMS_ENV=dev
    command: npm run serve

  test:
    build:
      context: ..  # Parent dir so we can access both git-cms and git-stunts
      dockerfile: git-cms/Dockerfile
      target: test
    volumes:
      - .:/app
      - /app/node_modules
    environment:
      - CI=true
    command: npm run test:local
